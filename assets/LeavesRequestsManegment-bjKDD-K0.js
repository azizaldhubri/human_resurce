import{r as n,o as D,A as k,j as e,w as x,x as f,v as z,y as A,z as U,G as C,e as E,g as F,I,J as B,K as P,O as M,Q as W,V as H,X as G,F as J,t as K,N as O}from"./index-CxioH5k5.js";function Q(t){const v=t.currentUser||{name:""},p=t.role||{},[r,u]=n.useState(""),[d,L]=n.useState(""),[b,$]=n.useState([]),[S,j]=n.useState(!1),m=t.data.filter(a=>D(a.created_at)===d),_=b.filter(a=>D(a.created_at)===d),w=d.length!==0?r.length>0?_:m:r.length>0?b:t.data;n.useEffect(()=>{const a=setTimeout(()=>{r.length>0?N():j(!1)},500);return()=>clearTimeout(a)},[r]);async function N(){try{const a=await k.post(`/${t.Linksearch}/search?title=${r}`);$(a.data)}catch(a){console.log(a)}finally{j(!1)}}const y={maxWidth:100,fontSize:"15px",fontWeight:"bold",borderRight:"2px solid black",backgroundColor:"#d3d9db",borderColor:"#c2c5c5",borderBottom:"3px solid gray",textAlign:"center"},l={maxWidth:100,fontSize:"15px",borderRight:"2px solid black",borderColor:"#c2c5c5",borderBottom:"3px solid gray",textAlign:"center"},g=t.header.map((a,T)=>e.jsx(x,{sx:y,children:a.name},T)),i=w.map((a,T)=>e.jsxs(f,{children:[e.jsx(x,{sx:l,children:a.id}),t.header.map((s,q)=>e.jsx(x,{sx:l,children:s.key==="image"?e.jsx("img",{width:"50px",src:a[s.key],alt:""}):s.key==="images"?e.jsx("div",{className:"d-flix align-items-center justify-content-between  gap-2 ",children:a[s.key].map((c,h)=>e.jsx("img",{width:"50px",src:c.image,alt:""},h))}):s.key==="role"?a[s.key]:s.key==="employee_name"?a.employee.name:s.key==="employee_id"?a.employee_id:s.key==="leave_type"?a.leave_type.name:s.key==="file_paths"?e.jsx("div",{className:"  d-flex align-items-center justify-content-center",children:a.file_paths.length>0?e.jsx("div",{className:" d-flex gap-3   py-3 px-3  flex-wrap   ",children:a.file_paths&&a.file_paths.map((c,h)=>e.jsx("div",{className:" ",style:{width:"100px"},children:z.map((o,R)=>e.jsx("div",{children:o.name.includes(c.split(".").pop())&&e.jsxs("div",{children:[e.jsx("img",{src:o.type=="img"?` ${o.pathimg}/${c}`:` ${o.pathimg}`,width:"30px",height:"30px",alt:"img"}),e.jsx("p",{className:"m-0",children:A(U(c,h),10)}),e.jsx("a",{className:"fs-5 text-danger",href:o.type=="img"?`${o.pathDownload}/${C(c,h)}`:`${o.pathDownload}/${C(c,h)}`,children:"Download"})]})},R))},h))}):e.jsx("p",{className:"m-0  ",children:"لا توجد مرفقات"})}):s.key==="status"?a.status==="pending"?"قيد الانتظار":a.status==="approved"?"موافق عليه":"مرفوض":s.key==="approver"?a.status==="pending"?"لم يتم الموافقة بعد":a.approver?.name:s.key==="opration"?a.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>t.handleStatusUpdate(a.id,"approved"),className:"approve-btn",children:"موافقة ✅"}),e.jsx("button",{onClick:()=>t.handleStatusUpdate(a.id,"rejected"),className:"reject-btn",children:"رفض ❌"})]}):a.status==="approved"?"موافَق عليه":"مرفوض":a[s.key]==="employee_name"?e.jsxs("p",{style:{color:"red",margin:"0"},children:[a[s.key]," (you)"]}):s.key==="month"?a.month+"/ "+a.year:s.key==="created_at"||s.key==="updated_at"?D(a[s.key]):a[s.key]},q)),p==="admin"&&e.jsx(x,{sx:l,children:e.jsxs("div",{className:"d-flex align-items-center  justify-content-center gap-3",children:[e.jsx(E,{to:`${a.id}`,children:e.jsx(F,{fontSize:"19px",icon:I})}),v.name!==a.name&&e.jsx(e.Fragment,{children:e.jsx(F,{onClick:()=>t.delete(a.id),fontSize:"19px",color:"red",cursor:"pointer",icon:B})})]})})]},T));return e.jsxs(e.Fragment,{children:[e.jsx(P,{component:M,sx:{width:"100%"},children:e.jsxs(W,{"aria-label":"simple table",sx:{marginTop:0,width:"100%"},children:[e.jsx(H,{className:"border primary ",children:e.jsxs(f,{children:[e.jsx(x,{sx:y,children:"م"}),g,p==="admin"&&e.jsx(x,{sx:y,children:"Action"})]})}),e.jsx(G,{children:t.loading?e.jsx(f,{className:"text-center ",children:e.jsx("td",{colSpan:12,children:"Loading..."})}):S?e.jsx(f,{className:"text-center",children:e.jsx("td",{colSpan:12,children:"Searching..."})}):i})]})}),e.jsx("div",{className:"d-flex align-items-center justify-content-center flex-wrap mt-2      w-100 mb-2  ",children:!r&&!d&&e.jsx("div",{className:"col-2 ",children:e.jsxs(J.Select,{className:"col-2  ps-3   ",onChange:a=>t.setLimit(a.target.value),"aria-label":"Default select example",style:{width:"70px",paddingLeft:"30px",fontSize:"15px"},children:[e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"})]})})})]})}function X(){const[t,v]=n.useState([]),[p,r]=n.useState(1),[u,d]=n.useState(3),[L,b]=n.useState(!1);let S=n.useContext(K).setIsupdateNotifaction;function j(){S(l=>!l)}n.useEffect(()=>{m()},[u]);async function m(){try{await k.get(`leave-requests? limit=${u}&page=${p}`).then(l=>{v(l.data.data)})}catch(l){console.log(l)}}async function _(l,g){try{await k.post(`leave-requests/${l}/status`,{status:g,comments:g==="approved"?"تمت الموافقة":"تم الرفض",link_notification:g==="approved"?"/dashboard/LeaveBalancesTable":"/dashboard/LeavesRequestsManegment"}).then(i=>console.log(i.data)),m(),j()}catch(i){console.log(i.response.data.message),i.response.data.message==="رصيد الإجازة غير كافٍ!"&&alert("رصيد الإجازة غير كافٍ!"),m()}}async function w(){await k.get("notifications")}n.useEffect(()=>{w()},[]);const N=[{key:"employee_id",name:"رقم الموظف"},{key:"employee_name",name:"اسم الموظف"},{key:"leave_type",name:"نوع الإجازة"},{key:"start_date",name:"بداية الإجازة  "},{key:"end_date",name:"تاريخ انتهاء الاجازه"},{key:"total_days",name:"عدد الإيام"},{key:"reason",name:"السبب"},{key:"status",name:"الحالة"},{key:"approver",name:"	الموافِقة"},{key:"file_paths",name:"	المرفقات"},{key:"opration",name:"العمليات"}],y=[{name:"طلبات الاجازة",link:"#"}];return e.jsxs("div",{className:"w-100  border  border-primary   col-12 col-lg-12 col-md-12 col-sm-12  px-1 py-1   ",children:[e.jsx(O,{nav:y}),e.jsx("div",{className:"mt-0   p-2 pt-0 ",style:{},children:e.jsx(Q,{limit:u,setLimit:d,page:p,header:N,data:t,setPage:r,loading:L,edit:"",total:0,search:"name",Linksearch:t,handleStatusUpdate:_,role:""})})]})}export{X as default};
